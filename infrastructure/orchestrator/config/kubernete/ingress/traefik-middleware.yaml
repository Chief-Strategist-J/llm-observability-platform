apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: security-headers-${INSTANCE_ID}
  namespace: ${NAMESPACE}
  labels:
    app: middleware
    instance: "${INSTANCE_ID}"
spec:
  headers:
    frameDeny: true
    sslRedirect: false
    stsIncludeSubdomains: true
    stsPreload: true
    stsSeconds: 31536000
    contentTypeNosniff: true
    browserXssFilter: true
    referrerPolicy: "strict-origin-when-cross-origin"
    permissionsPolicy: "geolocation=(), microphone=(), camera=()"
    customResponseHeaders:
      X-Powered-By: ""
      Server: ""
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: rate-limit-${INSTANCE_ID}
  namespace: ${NAMESPACE}
  labels:
    app: middleware
    instance: "${INSTANCE_ID}"
spec:
  rateLimit:
    average: 100
    burst: 50
    period: 1s
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: compression-${INSTANCE_ID}
  namespace: ${NAMESPACE}
  labels:
    app: middleware
    instance: "${INSTANCE_ID}"
spec:
  compress: {}
